<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate Generator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Set body font */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Define A4 size for certificates */
        .certificate {
            width: 297mm;
            height: 210mm;
            /* A4 Landscape */
            position: relative;
            overflow: hidden;
            background-color: white;
            background-size: 100% 100%;
            background-repeat: no-repeat;
            page-break-after: always;
            /* Ensure each cert is on a new page */
            margin: 0;
            padding: 0;
        }

        .certificate-placeholder {
            width: 29.7cm;
            height: 21cm;
            /* A4 Landscape */
            position: relative;
            overflow: hidden;
            background-color: #f0f0f0;
            background-size: 100% 100%;
            background-repeat: no-repeat;
            border: 1px dashed #999;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }

        /* Styles for text on the certificate */
        .cert-logo,
        .cert-name,
        .cert-ic,
        .cert-type,
        .cert-reason,
        .cert-event,
        .cert-signer {
            position: absolute;
            text-align: center;
            /* Default alignment */
        }

        /* Hide background for printing by default */
        .certificate {
            background-image: none !important;
        }

        /* Show background only if 'print-background' class is added */
        .print-background .certificate {
            background-image: var(--cert-bg-image) !important;
        }

        /* Print-specific styles */
        @media print {
            body {
                padding: 0;
                margin: 0;
                /* FIX: Force a white background for printing to hide the app's grey bg */
                background-color: #ffffff !important;
            }

            /* Hide all non-certificate elements */
            #app-header,
            #controls-area {
                display: none !important;
            }

            /* Ensure preview area is visible and certificates are the only content */
            /* FIX: Override on-screen gap and ensure flex-col */
            #certificate-preview-area {
                display: flex !important;
                flex-direction: column !important;
                gap: 0 !important;
                width: 100% !important;
                margin: 0;
                padding: 0;
            }

            /* Ensure certificates take up full page */
            .certificate {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
                page-break-after: always;
                /* Ensure each cert is on a new page */
                border: none;
                box-shadow: none;
            }
        }
    </style>
</head>

<body class="bg-gray-100 p-4 lg:p-8">

    <div class="max-w-7xl mx-auto">
        <header id="app-header" class="mb-8">
            <h1 class="text-4xl font-bold text-gray-800 text-center">Certificate Generator</h1>
            <p class="text-center text-gray-600 mt-2">Upload a CSV, set your design, and print certificates in bulk.</p>
        </header>

        <!-- Main Layout: Controls | Preview -->
        <div class="flex flex-col lg:flex-row lg:gap-8">

            <!-- Left Panel: Controls -->
            <aside id="controls-area" class="w-full lg:w-1/3 xl:w-1/4 mb-8 lg:mb-0">
                <div class="sticky top-8 bg-white p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-semibold text-gray-700 border-b pb-3 mb-4">Controls</h2>

                    <!-- General Settings -->
                    <details class="mb-4" open>
                        <summary class="font-semibold text-lg cursor-pointer text-gray-700">General</summary>
                        <div class="mt-4 space-y-4">
                            <!-- Certificate Type Dropdown -->
                            <div>
                                <label for="cert-type-input" class="block text-sm font-medium text-gray-700">Type of Certificate</label>
                                <select id="cert-type-input" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                    <option>Sijil Penghargaan</option>
                                    <option>Sijil Penyertaan</option>
                                </select>
                            </div>

                            <!-- Reason Input -->
                            <div>
                                <label for="reason-input" class="block text-sm font-medium text-gray-700">Reason for Certificate (multi-line)</label>
                                <textarea id="reason-input" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="cth: Telah menyertai..."></textarea>
                            </div>

                            <!-- Event Name Input -->
                            <div>
                                <label for="event-name" class="block text-sm font-medium text-gray-700">Event Name</label>
                                <input type="text" id="event-name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Event Name">
                            </div>

                            <!-- Signer Name Input -->
                            <div>
                                <label for="signer-name" class="block text-sm font-medium text-gray-700">Signer's Name</label>
                                <input type="text" id="signer-name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Signer's Name">
                            </div>

                            <!-- Signer Title Input -->
                            <div>
                                <label for="signer-title" class="block text-sm font-medium text-gray-700">Signer's Title</label>
                                <input type="text" id="signer-title" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Signer's Title">
                            </div>

                            <!-- CSV Upload -->
                            <div>
                                <label for="csv-file" class="block text-sm font-medium text-gray-700">Upload Name List (CSV)</label>
                                <input type="file" id="csv-file" accept=".csv" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                                <p class="text-xs text-gray-500 mt-1">Col 1: Name, Col 2: IC Number</p>
                            </div>

                            <!-- Background Image Upload -->
                            <div>
                                <label for="bg-image" class="block text-sm font-medium text-gray-700">Upload Certificate Background (A4)</label>
                                <input type="file" id="bg-image" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                            </div>

                            <!-- Logo Upload -->
                            <div>
                                <label for="logo-image" class="block text-sm font-medium text-gray-700">Upload Logo</label>
                                <input type="file" id="logo-image" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                            </div>

                            <!-- Generate Button -->
                            <button id="generate-certs" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">Generate Certificates</button>

                            <!-- Print Checkbox -->
                            <div class="flex items-center">
                                <input id="print-bg" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="print-bg" class="ml-2 block text-sm text-gray-900">Print background image?</label>
                            </div>
                        </div>
                    </details>

                    <!-- Alignment Controls -->
                    <h3 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4 mt-6">Alignment & Style</h3>

                    <!-- Logo Controls -->
                    <details class="mb-2 border rounded-md p-3" open>
                        <summary class="font-semibold text-gray-700 cursor-pointer">Logo</summary>
                        <div class="mt-4 space-y-3">
                            <div>
                                <label for="logo-top" class="block text-sm font-medium text-gray-600">Position (Top %)</label>
                                <input type="range" id="logo-top" min="0" max="100" value="10" class="w-full">
                            </div>
                            <div>
                                <label for="logo-left" class="block text-sm font-medium text-gray-600">Position (Left %)</label>
                                <input type="range" id="logo-left" min="0" max="100" value="10" class="w-full">
                            </div>
                            <div>
                                <label for="logo-width" class="block text-sm font-medium text-gray-600">Width (%)</label>
                                <input type="range" id="logo-width" min="1" max="100" value="20" class="w-full">
                            </div>
                        </div>
                    </details>

                    <!-- Certificate Type Controls -->
                    <details class="mb-2 border rounded-md p-3" open>
                        <summary class="font-semibold text-gray-700 cursor-pointer">Certificate Type</summary>
                        <div class="mt-4 space-y-3">
                            <div>
                                <label for="type-top" class="block text-sm font-medium text-gray-600">Position (Top %)</label>
                                <input type="range" id="type-top" min="0" max="100" value="25" class="w-full">
                            </div>
                            <div>
                                <label for="type-size" class="block text-sm font-medium text-gray-600">Font Size (pt)</label>
                                <input type="range" id="type-size" min="8" max="72" value="32" class="w-full">
                            </div>
                            <div>
                                <label for="type-font" class="block text-sm font-medium text-gray-600">Font Family</label>
                                <select id="type-font" class="mt-1 block w-full text-sm border-gray-300 rounded-md">
                                    <option>Times New Roman</option>
                                    <option>Arial</option>
                                    <option>Helvetica</option>
                                    <option>Verdana</option>
                                    <option>Georgia</option>
                                </select>
                            </div>
                        </div>
                    </details>

                    <!-- Participant Name Controls -->
                    <details class="mb-2 border rounded-md p-3" open>
                        <summary class="font-semibold text-gray-700 cursor-pointer">Participant Name</summary>
                        <div class="mt-4 space-y-3">
                            <div>
                                <label for="name-top" class="block text-sm font-medium text-gray-600">Position (Top %)</label>
                                <input type="range" id="name-top" min="0" max="100" value="40" class="w-full">
                            </div>
                            <div>
                                <label for="name-size" class="block text-sm font-medium text-gray-600">Font Size (pt)</label>
                                <input type="range" id="name-size" min="8" max="72" value="48" class="w-full">
                            </div>
                            <div>
                                <label for="name-font" class="block text-sm font-medium text-gray-600">Font Family</label>
                                <select id="name-font" class="mt-1 block w-full text-sm border-gray-300 rounded-md">
                                    <option>Times New Roman</option>
                                    <option>Arial</option>
                                    <option>Helvetica</option>
                                    <option>Verdana</option>
                                    <option>Georgia</option>
                                </select>
                            </div>
                        </div>
                    </details>

                    <!-- IC Number Controls -->
                    <details class="mb-2 border rounded-md p-3" open>
                        <summary class="font-semibold text-gray-700 cursor-pointer">IC Number</summary>
                        <div class="mt-4 space-y-3">
                            <div>
                                <label for="ic-top" class="block text-sm font-medium text-gray-600">Position (Top %)</label>
                                <input type="range" id="ic-top" min="0" max="100" value="50" class="w-full">
                            </div>
                            <div>
                                <label for="ic-size" class="block text-sm font-medium text-gray-600">Font Size (pt)</label>
                                <input type="range" id="ic-size" min="8" max="72" value="20" class="w-full">
                            </div>
                            <div>
                                <label for="ic-font" class="block text-sm font-medium text-gray-600">Font Family</label>
                                <select id="ic-font" class="mt-1 block w-full text-sm border-gray-300 rounded-md">
                                    <option>Times New Roman</option>
                                    <option>Arial</option>
                                    <option>Helvetica</option>
                                    <option>Verdana</option>
                                    <option>Georgia</option>
                                </select>
                            </div>
                        </div>
                    </details>

                    <!-- Reason Controls -->
                    <details class="mb-2 border rounded-md p-3" open>
                        <summary class="font-semibold text-gray-700 cursor-pointer">Reason</summary>
                        <div class="mt-4 space-y-3">
                            <div>
                                <label for="reason-top" class="block text-sm font-medium text-gray-600">Position (Top %)</label>
                                <input type="range" id="reason-top" min="0" max="100" value="58" class="w-full">
                            </div>
                            <div>
                                <label for="reason-size" class="block text-sm font-medium text-gray-600">Font Size (pt)</label>
                                <input type="range" id="reason-size" min="8" max="72" value="18" class="w-full">
                            </div>
                            <div>
                                <label for="reason-font" class="block text-sm font-medium text-gray-600">Font Family</label>
                                <select id="reason-font" class="mt-1 block w-full text-sm border-gray-300 rounded-md">
                                    <option>Times New Roman</option>
                                    <option>Arial</option>
                                    <option>Helvetica</option>
                                    <option>Verdana</option>
                                    <option>Georgia</option>
                                </select>
                            </div>
                        </div>
                    </details>

                    <!-- Event Name Controls -->
                    <details class="mb-2 border rounded-md p-3" open>
                        <summary class="font-semibold text-gray-700 cursor-pointer">Event Name</summary>
                        <div class="mt-4 space-y-3">
                            <div>
                                <label for="event-top" class="block text-sm font-medium text-gray-600">Position (Top %)</label>
                                <input type="range" id="event-top" min="0" max="100" value="65" class="w-full">
                            </div>
                            <div>
                                <label for="event-size" class="block text-sm font-medium text-gray-600">Font Size (pt)</label>
                                <input type="range" id="event-size" min="8" max="72" value="24" class="w-full">
                            </div>
                            <div>
                                <label for="event-font" class="block text-sm font-medium text-gray-600">Font Family</label>
                                <select id="event-font" class="mt-1 block w-full text-sm border-gray-300 rounded-md">
                                    <option>Times New Roman</option>
                                    <option>Arial</option>
                                    <option>Helvetica</option>
                                    <option>Verdana</option>
                                    <option>Georgia</option>
                                </select>
                            </div>
                        </div>
                    </details>

                    <!-- Signer Controls -->
                    <details class="mb-2 border rounded-md p-3" open>
                        <summary class="font-semibold text-gray-700 cursor-pointer">Signer's Name</summary>
                        <div class="mt-4 space-y-3">
                            <div>
                                <label for="signer-top" class="block text-sm font-medium text-gray-600">Position (Top %)</label>
                                <input type="range" id="signer-top" min="0" max="100" value="80" class="w-full">
                            </div>
                            <div>
                                <label for="signer-left" class="block text-sm font-medium text-gray-600">Position (Left %)</label>
                                <input type="range" id="signer-left" min="0" max="100" value="50" class="w-full">
                            </div>
                            <div>
                                <label for="signer-width" class="block text-sm font-medium text-gray-600">Width (%)</label>
                                <input type="range" id="signer-width" min="10" max="100" value="40" class="w-full">
                            </div>
                            <div>
                                <label for="signer-size" class="block text-sm font-medium text-gray-600">Font Size (pt)</label>
                                <input type="range" id="signer-size" min="8" max="72" value="14" class="w-full">
                            </div>
                            <div>
                                <label for="signer-font" class="block text-sm font-medium text-gray-600">Font Family</label>
                                <select id="signer-font" class="mt-1 block w-full text-sm border-gray-300 rounded-md">
                                    <option>Times New Roman</option>
                                    <option>Arial</option>
                                    <option>Helvetica</option>
                                    <option>Verdana</option>
                                    <option>Georgia</option>
                                </select>
                            </div>
                        </div>
                    </details>


                    <!-- Print Button -->
                    <div class="mt-8 text-center">
                        <button id="print-certs" class="bg-green-600 text-white py-3 px-6 rounded-md font-semibold hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                            Print All Certificates
                        </button>
                    </div>

                </div>
            </aside>

            <!-- Right Panel: Certificate Preview -->
            <main id="certificate-preview-area" class="w-full lg:w-2/3 xl:w-3/4 flex flex-col gap-8">
                <!-- Placeholder -->
                <div id="cert-placeholder" class="certificate-placeholder shadow-lg">
                    <span>A4 Preview Area - Upload files and click "Generate"</span>
                </div>
                <!-- Generated certificates will be appended here -->
            </main>

        </div>
    </div>

    <script>
        // Store element references
        const controls = {
            eventName: document.getElementById('event-name'),
            reasonInput: document.getElementById('reason-input'),
            certTypeInput: document.getElementById('cert-type-input'),
            signerName: document.getElementById('signer-name'),
            signerTitle: document.getElementById('signer-title'),
            csvFile: document.getElementById('csv-file'),
            bgImage: document.getElementById('bg-image'),
            logoImage: document.getElementById('logo-image'),
            generateBtn: document.getElementById('generate-certs'),
            printBtn: document.getElementById('print-certs'),
            printBg: document.getElementById('print-bg'),
            previewArea: document.getElementById('certificate-preview-area'),
            placeholder: document.getElementById('cert-placeholder'),
        };

        const sliders = {
            // Logo
            logoTop: document.getElementById('logo-top'),
            logoLeft: document.getElementById('logo-left'),
            logoWidth: document.getElementById('logo-width'),
            // Cert Type
            typeTop: document.getElementById('type-top'),
            typeSize: document.getElementById('type-size'),
            typeFont: document.getElementById('type-font'),
            // Name
            nameTop: document.getElementById('name-top'),
            nameSize: document.getElementById('name-size'),
            nameFont: document.getElementById('name-font'),
            // IC
            icTop: document.getElementById('ic-top'),
            icSize: document.getElementById('ic-size'),
            icFont: document.getElementById('ic-font'),
            // Reason
            reasonTop: document.getElementById('reason-top'),
            reasonSize: document.getElementById('reason-size'),
            reasonFont: document.getElementById('reason-font'),
            // Event
            eventTop: document.getElementById('event-top'),
            eventSize: document.getElementById('event-size'),
            eventFont: document.getElementById('event-font'),
            // Signer
            signerTop: document.getElementById('signer-top'),
            signerLeft: document.getElementById('signer-left'),
            signerWidth: document.getElementById('signer-width'),
            signerSize: document.getElementById('signer-size'),
            signerFont: document.getElementById('signer-font'),
        };

        let backgroundUrl = '';
        let logoUrl = '';
        let participantData = [];

        // --- Event Listeners ---

        // Handle Background Image Upload
        controls.bgImage.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    backgroundUrl = event.target.result;
                    const bgImageCss = `url(${backgroundUrl})`;
                    document.documentElement.style.setProperty('--cert-bg-image', bgImageCss);
                    // Apply to placeholder
                    controls.placeholder.style.backgroundImage = bgImageCss;
                    // Apply to existing certificates
                    document.querySelectorAll('.certificate').forEach(cert => {
                        cert.style.backgroundImage = bgImageCss;
                    });
                };
                reader.readAsDataURL(file);
            }
        });

        // Handle Logo Image Upload
        controls.logoImage.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    logoUrl = event.target.result;
                    // Add logo to placeholder for preview
                    const existingLogo = controls.placeholder.querySelector('.cert-logo');
                    if (existingLogo) {
                        existingLogo.src = logoUrl;
                    } else {
                        const logoImg = document.createElement('img');
                        logoImg.src = logoUrl;
                        logoImg.className = 'cert-logo';
                        logoImg.style.top = `${sliders.logoTop.value}%`;
                        logoImg.style.left = `${sliders.logoLeft.value}%`;
                        logoImg.style.width = `${sliders.logoWidth.value}%`;
                        logoImg.style.transform = 'translateX(-50%)'; // Center horizontally
                        controls.placeholder.appendChild(logoImg);
                    }
                };
                reader.readAsDataURL(file);
            }
        });

        // Handle CSV File Upload
        controls.csvFile.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const csvData = event.target.result;
                    parseCSV(csvData);
                };
                reader.readAsText(file);
            }
        });

        // Handle Generate Certificates Button
        controls.generateBtn.addEventListener('click', () => {
            if (participantData.length === 0) {
                alert('Please upload a CSV file with participant data first.');
                return;
            }

            // Clear previous certificates and show placeholder
            controls.previewArea.innerHTML = ''; // Clear all
            controls.previewArea.appendChild(controls.placeholder); // Add placeholder back

            const eventName = controls.eventName.value;
            const certType = controls.certTypeInput.value;
            const reason = controls.reasonInput.value.replace(/\n/g, '<br>'); // Support multi-line
            const signerName = controls.signerName.value;
            const signerTitle = controls.signerTitle.value;

            // Get all style values
            const styles = getAllStyles();

            // Hide placeholder
            controls.placeholder.style.display = 'none';

            // Generate HTML for each participant
            participantData.forEach(participant => {
                const certHTML = generateCertificateHTML(participant, eventName, certType, reason, signerName, signerTitle, styles);
                controls.previewArea.insertAdjacentHTML('beforeend', certHTML);
            });
        });

        // Handle Print Button
        controls.printBtn.addEventListener('click', () => {
            const printBackground = controls.printBg.checked;
            if (printBackground) {
                document.body.classList.add('print-background');
            }

            window.print();

            // Clean up class after print dialog
            if (printBackground) {
                document.body.classList.remove('print-background');
            }
        });

        // --- Slider Event Listeners for Live Update ---
        // This is simplified. A full implementation would update all generated certs.
        // For now, we apply styles on generation.
        function addSliderListeners() {
            Object.values(sliders).forEach(slider => {
                if (slider) {
                    slider.addEventListener('input', () => {
                        // This function is now a placeholder.
                        // Styles are read directly upon generation.
                        // A more complex app would update all live certs here.
                    });
                }
            });
        }
        addSliderListeners();


        // --- Helper Functions ---

        /**
         * Parses CSV text data into an array of objects.
         * Assumes Col 1 = Name, Col 2 = IC
         */
        function parseCSV(csvData) {
            const lines = csvData.trim().split('\n');
            participantData = []; // Clear previous data
            
            // Skip header if present (simple check for "name")
            const startLine = lines[0].toLowerCase().includes('name') ? 1 : 0;

            for (let i = startLine; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line) {
                    const parts = line.split(',');
                    if (parts.length >= 2) {
                        participantData.push({
                            name: parts[0].trim(),
                            ic: parts[1].trim()
                        });
                    }
                }
            }
            // console.log('Parsed data:', participantData);
            alert(`Loaded ${participantData.length} participants.`);
        }

        /**
         * Reads all slider and font values from the controls.
         */
        function getAllStyles() {
            return {
                logo: {
                    top: `${sliders.logoTop.value}%`,
                    left: `${sliders.logoLeft.value}%`,
                    width: `${sliders.logoWidth.value}%`,
                    transform: `translateX(-50%)`, // Center horizontally
                },
                type: {
                    top: `${sliders.typeTop.value}%`,
                    fontSize: `${sliders.typeSize.value}pt`,
                    fontFamily: sliders.typeFont.value,
                    transform: 'translateX(-50%)',
                    left: '50%',
                    color: 'black',
                    fontWeight: 'bold',
                },
                name: {
                    top: `${sliders.nameTop.value}%`,
                    fontSize: `${sliders.nameSize.value}pt`,
                    fontFamily: sliders.nameFont.value,
                    transform: 'translateX(-50%)',
                    left: '50%',
                    color: 'black',
                    fontWeight: 'bold',
                },
                ic: {
                    top: `${sliders.icTop.value}%`,
                    fontSize: `${sliders.icSize.value}pt`,
                    fontFamily: sliders.icFont.value,
                    transform: 'translateX(-50%)',
                    left: '50%',
                    color: 'black',
                },
                reason: {
                    top: `${sliders.reasonTop.value}%`,
                    fontSize: `${sliders.reasonSize.value}pt`,
                    fontFamily: sliders.reasonFont.value,
                    transform: 'translateX(-50%)',
                    left: '50%',
                    width: '80%', // Allow reason to wrap
                },
                event: {
                    top: `${sliders.eventTop.value}%`,
                    fontSize: `${sliders.eventSize.value}pt`,
                    fontFamily: sliders.eventFont.value,
                    transform: 'translateX(-50%)',
                    left: '50%',
                    color: 'black',
                    fontWeight: 'bold',
                },
                signer: {
                    top: `${sliders.signerTop.value}%`,
                    left: `${sliders.signerLeft.value}%`,
                    width: `${sliders.signerWidth.value}%`,
                    fontSize: `${sliders.signerSize.value}pt`,
                    fontFamily: sliders.signerFont.value,
                    transform: `translateX(-50%)`, // Center within its width
                }
            };
        }

        /**
         * Generates the HTML for a single certificate.
         */
        function generateCertificateHTML(participant, eventName, certType, reason, signerName, signerTitle, styles) {
            const bgStyle = backgroundUrl ? `style="background-image: url(${backgroundUrl})"` : '';

            // Helper to apply styles
            const applyStyle = (style) => Object.entries(style).map(([k, v]) => `${k}:${v}`).join(';');
            
            // Generate Logo HTML
            const logoHTML = logoUrl ? `<img src="${logoUrl}" class="cert-logo" style="${applyStyle(styles.logo)}">` : '';

            return `
                <div class="certificate shadow-lg" ${bgStyle}>
                    
                    ${logoHTML}

                    <!-- Certificate Type -->
                    <div class="cert-type" style="${applyStyle(styles.type)}">
                        ${certType}
                        <br>
                        <span style="font-size: 0.7em; font-weight: normal;">Adalah dengan ini diperakui bahawa</span>
                    </div>

                    <!-- Participant Name -->
                    <div class="cert-name" style="${applyStyle(styles.name)}">
                        ${participant.name}
                    </div>

                    <!-- IC Number -->
                    <div class="cert-ic" style="${applyStyle(styles.ic)}">
                        ${participant.ic}
                    </div>

                    <!-- Reason -->
                    <div class="cert-reason" style="${applyStyle(styles.reason)}">
                        ${reason}
                    </div>

                    <!-- Event Name -->
                    <div class="cert-event" style="${applyStyle(styles.event)}">
                        ${eventName}
                    </div>

                    <!-- Signer -->
                    <div class="cert-signer" style="${applyStyle(styles.signer)}">
                        <div style="border-top: 2px dotted #000; width: 100%; margin: 0 auto 8px auto;"></div>
                        <strong>${signerName}</strong>
                        <div>${signerTitle}</div>
                    </div>

                </div>
            `;
        }

    </script>

</body>

</html>

